{% extends 'base.html' %}
{% block title %}Help Â· Historical Document Reader{% endblock %}

{% block content %}
<div class="container help-page">
    <h1>Help centre</h1>
    <p class="help-intro">This page focuses on using the running application. For environment setup and deployment steps, use the repository <code>readme.md</code> and <code>setup.md</code>.</p>

    <section id="quick-navigation" class="help-section">
        <h2>Quick navigation</h2>
        <ul>
            <li><a href="{{ url_for('search_database') }}" data-help="Open the Search Database workspace.">Search Database</a>: run structured queries and open documents.</li>
            <li><a href="{{ url_for('network_analysis_page') }}" data-help="Open the Network Analysis workspace.">Network</a>: explore entity graphs and launch network-derived document lists.</li>
            <li><a href="{{ url_for('historian_agent_page') }}" data-help="Open the Historian Agent chat workspace.">Historian Agent</a>: ask source-grounded research questions.</li>
            <li><a href="{{ url_for('database_info') }}" data-help="Open Database Information.">Database Information</a>: inspect field coverage and metadata distribution.</li>
            <li><a href="{{ url_for('settings') }}" data-help="Open Settings.">Settings</a>: adjust UI preferences and model configuration.</li>
        </ul>
    </section>

    <section id="search-workflow" class="help-section">
        <h2>Search and browse documents</h2>
        <ol>
            <li>Open <strong>Search Database</strong>.</li>
            <li>Select one or more fields, operators, and search values.</li>
            <li>Run the query and open a result document.</li>
            <li>Use <strong>Previous</strong> and <strong>Next</strong> in document view to move through that result list.</li>
            <li>Use <strong>Export selected to CSV</strong> when you need a spreadsheet-ready subset.</li>
        </ol>
    </section>

    <section id="document-viewer" class="help-section">
        <h2>Document viewer and network context</h2>
        <ul>
            <li><strong>Named Entities</strong>: click an entity to open a quick network popup and jump to its ego network.</li>
            <li><strong>Network Context</strong>: inline graph of relationships among entities in the current document.</li>
            <li><strong>Related Documents via Network</strong>: cross-document discovery panel powered by shared/connected entities.</li>
            <li><strong>Image controls</strong>: rotate, zoom, adjust brightness/contrast/saturation/hue/sharpen/threshold, and apply presets.</li>
        </ul>
        <p><strong>Shared entities</strong> are canonical entities present in both the current and related document. <strong>Connected via</strong> lists bridge entities linked through one-hop network connections that help explain why the related document was surfaced.</p>
    </section>

    <section id="network-analysis" class="help-section">
        <h2>Network Analysis workflow</h2>
        <p>Use Network Analysis to inspect the global entity graph or an entity-specific ego graph.</p>
        <ul>
            <li><strong>Entity types</strong>: include/exclude node categories.</li>
            <li><strong>Strict type match</strong>: when enabled, both edge endpoints must be selected types.</li>
            <li><strong>De-noise</strong>: choose cross-type only, all pairs, or within-type only.</li>
            <li><strong>Ranking</strong>: prioritize strongest, cross-type, rare-but-strong, or low-frequency edges.</li>
            <li><strong>Min. edge weight</strong>: remove weak co-occurrence links.</li>
            <li><strong>Max edges</strong>: cap graph size for readability/performance.</li>
            <li><strong>Document contains</strong>: keep only edges supported by documents containing that term across all fields.</li>
            <li><strong>Type-pair chips</strong>: click a chip in the stats bar to focus one pair family.</li>
            <li><strong>Reset</strong>: clear filters and return to default global view.</li>
        </ul>
        <p><strong>Open Document Viewer</strong> launches a list for the current network slice and preserves that list for Previous/Next navigation inside document view.</p>
    </section>

    <section id="historian-agent" class="help-section">
        <h2>Historian Agent usage</h2>
        <ul>
            <li><strong>Good (Fast)</strong>: quick direct retrieval and response.</li>
            <li><strong>Better (Monitored)</strong>: additional quality monitoring logic.</li>
            <li><strong>Best (Tiered)</strong>: confidence-based escalation for harder questions.</li>
            <li><strong>Tier 0 (Corpus Exploration)</strong>: broad exploration mode for orientation and hypothesis generation.</li>
        </ul>
        <p>Use suggested prompts for quick starts, watch the Pipeline Debug Log for trace details, and use Reset conversation to start a new thread.</p>
    </section>

    <section id="settings-and-files" class="help-section">
        <h2>Settings and archive files</h2>
        <ul>
            <li><strong>Settings</strong> currently manages UI tokens (fonts, sizes, colors, spacing).</li>
            <li><strong>Archive file management</strong> is available at <a href="{{ url_for('data_file_manager') }}" data-help="Open Archive File Management.">Archive Files</a> for uploading JSON/JSONL and downloading a ZIP snapshot.</li>
        </ul>
    </section>

    <section id="tooltips" class="help-section">
        <h2>Built-in guidance</h2>
        <p>Most controls now support delayed help tooltips. Hover or focus a control for about 2 seconds to see what it does.</p>
    </section>

    <section id="usage-troubleshooting" class="help-section">
        <h2>Usage troubleshooting</h2>
        <ul>
            <li><strong>No network edges visible</strong>: lower Min. edge weight, clear Document contains, or click Reset.</li>
            <li><strong>No related documents shown</strong>: the current document may not have enough shared or one-hop connected entities.</li>
            <li><strong>D3.js not loaded</strong>: refresh the page; if it persists, check that <code>/static/js/d3.v7.min.js</code> returns 200.</li>
            <li><strong>Historian Agent unavailable</strong>: verify model/provider configuration in Settings and any required API keys.</li>
        </ul>
    </section>
</div>
{% endblock %}
