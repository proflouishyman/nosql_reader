{% extends 'base.html' %}
{% block title %}Help Â· Historical Document Reader{% endblock %}

{% block content %}
<div class="container help-page">
    <h1>Help centre</h1>
    <p class="help-intro">This guide explains how to use the running application for research workflows.</p>

    <!-- Added section-level data-help so the help page itself participates in the tooltip system. -->
    <section class="help-section" id="navigation" data-help="Overview of main navigation destinations and their purpose.">
        <h2>Navigation overview</h2>
        <ul>
            <li><strong>Search Database:</strong> Build fielded queries and open result documents.</li>
            <li><strong>Historian Agent:</strong> Ask research questions and inspect cited sources.</li>
            <li><strong>Network Analysis:</strong> Explore entity co-occurrence graphs and launch a document viewer from the active network slice.</li>
            <li><strong>Settings:</strong> Adjust UI and model-related options.</li>
        </ul>
    </section>

    <section class="help-section" id="search-workflow" data-help="Step-by-step fielded search workflow from query to document viewer navigation.">
        <h2>Search workflow</h2>
        <ol>
            <li>Open <strong>Search Database</strong>.</li>
            <li>Select one or more fields and enter search terms.</li>
            <li>Use AND/OR/NOT logic to refine results.</li>
            <li>Open any result to enter the document viewer.</li>
        </ol>
        <p>The document viewer keeps your list context so <strong>Previous</strong> and <strong>Next</strong> move through the same result list.</p>
    </section>

    <section class="help-section" id="document-viewer" data-help="How entity context and related-document links work in document detail view.">
        <h2>Document viewer and network context</h2>
        <ul>
            <li><strong>Entity chips:</strong> Click an entity to open a quick network popup.</li>
            <li><strong>Related Documents via Network:</strong> Shows nearby documents connected through shared or bridging entities.</li>
            <li><strong>Shared:</strong> Entities present in both the current document and the related document.</li>
            <li><strong>Connected via:</strong> Bridge entities that connect the two documents in the network, even if not directly shared.</li>
        </ul>
    </section>

    <section class="help-section" id="network-analysis" data-help="Control reference for network filters, graph scope, and viewer launch behavior.">
        <h2>Network Analysis page</h2>
        <p>The Network Analysis page renders the global or ego entity graph and lets you tune what is shown.</p>

        <table>
            <thead>
                <tr>
                    <th scope="col" data-help="Name of a control on the Network Analysis page.">Control</th>
                    <th scope="col" data-help="Expected behavior of that control in graph rendering and filtering.">What it does</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Entity types</td>
                    <td>Include or exclude types like PERSON, ORG, GPE, OCCUPATION, EMPLOYEE_ID.</td>
                </tr>
                <tr>
                    <td>Strict type match</td>
                    <td>When on, both edge endpoints must match selected types.</td>
                </tr>
                <tr>
                    <td>Min. edge weight</td>
                    <td>Filters out weak ties that appear in fewer documents.</td>
                </tr>
                <tr>
                    <td>Max edges</td>
                    <td>Caps graph size for readability and performance.</td>
                </tr>
                <tr>
                    <td>Document contains</td>
                    <td>Restricts edges to evidence documents containing that text across document fields.</td>
                </tr>
                <tr>
                    <td>Person tie minimum documents</td>
                    <td>Counts PERSON endpoints only when their mention count meets the threshold (default: 3).</td>
                </tr>
                <tr>
                    <td>Reset</td>
                    <td>Restores default controls and returns to canonical global graph view.</td>
                </tr>
                <tr>
                    <td>Open Document Viewer</td>
                    <td>Launches a list-viewer built from the current network slice; document Previous/Next follows that list.</td>
                </tr>
            </tbody>
        </table>
    </section>

    <section class="help-section" id="network-stats" data-help="Server-side network statistics panel capabilities and interpretation guide.">
        <h2>Statistical analysis panel</h2>
        <p>At the bottom of the Network Analysis page, click <strong>Compute Statistics</strong> to run server-side tests for the current filters.</p>
        <ul>
            <li><strong>Graph summary:</strong> nodes, edges, components, density.</li>
            <li><strong>Assortativity tests:</strong> whether same-attribute ties are above chance.</li>
            <li><strong>Mixing matrix:</strong> over/under-represented category pairings.</li>
            <li><strong>Degree distribution:</strong> inequality and hub structure.</li>
            <li><strong>Communities:</strong> detected groups and attribute alignment.</li>
            <li><strong>Observed vs random:</strong> significance versus configuration-model null graphs.</li>
            <li><strong>Gatekeepers:</strong> bridge entities ranked by bridge score.</li>
        </ul>
        <p>First run can take longer; repeated runs are cached.</p>
    </section>

    <section class="help-section" id="historian-agent" data-help="Recommended Historian Agent usage for question quality and citation follow-up.">
        <h2>Historian Agent workflow</h2>
        <ul>
            <li>Ask focused historical questions.</li>
            <li>Inspect returned citations and open source documents.</li>
            <li>Use Settings to switch providers/models and retrieval options.</li>
            <li>If responses look thin, narrow scope by period, person, place, or collection terms.</li>
        </ul>
    </section>

    <section class="help-section" id="troubleshooting" data-help="Common failure modes and first-response debugging actions.">
        <h2>Troubleshooting</h2>
        <ul>
            <li><strong>No network graph:</strong> check that `network_edges` is built and non-empty.</li>
            <li><strong>Network controls return empty graph:</strong> loosen filters (type set, min weight, document term, person threshold).</li>
            <li><strong>Statistics endpoint errors:</strong> verify backend logs and re-run after reducing graph filters.</li>
            <li><strong>Page looks stale:</strong> force refresh the browser.</li>
        </ul>
    </section>
</div>
{% endblock %}
